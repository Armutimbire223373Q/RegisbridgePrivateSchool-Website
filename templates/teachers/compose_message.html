{% extends "dashboard/base_dashboard.html" %}

{% block dashboard_title %}Compose Message{% endblock %}
{% block dashboard_heading %}Send Message{% endblock %}
{% block page_title %}Compose Message{% endblock %}
{% block page_subtitle %}Send messages to students and parents{% endblock %}

{% block dashboard_main %}
<form method="post" class="max-w-4xl mx-auto">
    {% csrf_token %}
    
    <div class="card">
        <h3 class="text-xl font-semibold text-gray-900 mb-6">New Message</h3>
        
        <!-- Message Title -->
        <div class="mb-6">
            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">Subject *</label>
            <input type="text" id="title" name="title" required
                   class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500"
                   placeholder="Enter message subject">
        </div>
        
        <!-- Recipients -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Recipients *</label>
            
            <!-- Tabs for Students and Parents -->
            <div class="border-b border-gray-200 mb-4">
                <nav class="-mb-px flex space-x-8">
                    <button type="button" onclick="showTab('students')" 
                            id="students-tab"
                            class="tab-button py-2 px-1 border-b-2 font-medium text-sm border-primary-500 text-primary-600">
                        Students
                    </button>
                    <button type="button" onclick="showTab('parents')"
                            id="parents-tab" 
                            class="tab-button py-2 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300">
                        Parents
                    </button>
                </nav>
            </div>
            
            <!-- Students Tab -->
            <div id="students-content" class="tab-content">
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Select Students:</span>
                        <div class="space-x-2">
                            <button type="button" onclick="selectAll('students')" class="btn-sm btn-outline">Select All</button>
                            <button type="button" onclick="selectNone('students')" class="btn-sm btn-outline">Clear All</button>
                        </div>
                    </div>
                </div>
                
                <div class="max-h-64 overflow-y-auto border border-gray-200 rounded-md p-2">
                    {% for student in students %}
                    <label class="flex items-center p-2 hover:bg-gray-50 rounded">
                        <input type="checkbox" name="recipients" value="{{ student.id }}" 
                               class="student-checkbox h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                        <div class="ml-3">
                            <div class="text-sm font-medium text-gray-900">{{ student.get_full_name }}</div>
                            <div class="text-sm text-gray-500">{{ student.student_profile.classroom.name }}</div>
                        </div>
                    </label>
                    {% empty %}
                    <p class="text-gray-500 text-center py-4">No students available</p>
                    {% endfor %}
                </div>
            </div>
            
            <!-- Parents Tab -->
            <div id="parents-content" class="tab-content hidden">
                <div class="mb-4">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-sm font-medium text-gray-700">Select Parents:</span>
                        <div class="space-x-2">
                            <button type="button" onclick="selectAll('parents')" class="btn-sm btn-outline">Select All</button>
                            <button type="button" onclick="selectNone('parents')" class="btn-sm btn-outline">Clear All</button>
                        </div>
                    </div>
                </div>
                
                <div class="max-h-64 overflow-y-auto border border-gray-200 rounded-md p-2">
                    {% for parent in parents %}
                    <label class="flex items-center p-2 hover:bg-gray-50 rounded">
                        <input type="checkbox" name="recipients" value="{{ parent.id }}" 
                               class="parent-checkbox h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                        <div class="ml-3">
                            <div class="text-sm font-medium text-gray-900">{{ parent.get_full_name }}</div>
                            <div class="text-sm text-gray-500">Parent</div>
                        </div>
                    </label>
                    {% empty %}
                    <p class="text-gray-500 text-center py-4">No parents available</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Message Content -->
        <div class="mb-6">
            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">Message *</label>
            <textarea id="content" name="content" rows="8" required
                      class="w-full border border-gray-300 rounded-md px-3 py-2 focus:ring-primary-500 focus:border-primary-500"
                      placeholder="Type your message here..."></textarea>
        </div>
        
        <!-- Form Actions -->
        <div class="flex items-center justify-between">
            <a href="{% url 'teachers:messages' %}" class="btn-outline">Cancel</a>
            <button type="submit" class="btn-primary">Send Message</button>
        </div>
    </div>
</form>

<script>
function showTab(tabName) {
    // Hide all tab contents
    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => content.classList.add('hidden'));
    
    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab-button');
    tabs.forEach(tab => {
        tab.classList.remove('border-primary-500', 'text-primary-600');
        tab.classList.add('border-transparent', 'text-gray-500');
    });
    
    // Show selected tab content
    document.getElementById(tabName + '-content').classList.remove('hidden');
    
    // Add active class to selected tab
    const activeTab = document.getElementById(tabName + '-tab');
    activeTab.classList.remove('border-transparent', 'text-gray-500');
    activeTab.classList.add('border-primary-500', 'text-primary-600');
}

function selectAll(type) {
    const checkboxes = document.querySelectorAll('.' + type + '-checkbox');
    checkboxes.forEach(checkbox => checkbox.checked = true);
}

function selectNone(type) {
    const checkboxes = document.querySelectorAll('.' + type + '-checkbox');
    checkboxes.forEach(checkbox => checkbox.checked = false);
}
</script>
{% endblock %}
