{% extends "base.html" %}

{% block extra_css %}
<style>
    .form-section {
        @apply bg-white rounded-2xl shadow-md p-6 mb-6;
    }
    
    .form-group {
        @apply mb-6;
    }
    
    .form-label {
        @apply block text-sm font-medium text-gray-700 mb-2;
    }
    
    .form-input {
        @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300;
    }
    
    .form-input.error {
        @apply border-error-500 ring-error-500;
    }
    
    .form-textarea {
        @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300 resize-vertical;
    }
    
    .form-select {
        @apply w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition-all duration-300 bg-white;
    }
    
    .form-checkbox {
        @apply w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500;
    }
    
    .form-radio {
        @apply w-4 h-4 text-primary-600 border-gray-300 focus:ring-primary-500;
    }
    
    .form-file {
        @apply block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-medium file:bg-primary-50 file:text-primary-700 hover:file:bg-primary-100;
    }
    
    .error-message {
        @apply mt-1 text-sm text-error-600;
    }
    
    .help-text {
        @apply mt-1 text-sm text-gray-500;
    }
    
    .form-actions {
        @apply flex flex-col sm:flex-row gap-3 justify-end pt-6 border-t border-gray-200;
    }
    
    .form-grid {
        @apply grid grid-cols-1 md:grid-cols-2 gap-6;
    }
    
    .form-grid-3 {
        @apply grid grid-cols-1 md:grid-cols-3 gap-6;
    }
    
    .required-field::after {
        content: " *";
        @apply text-error-500;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Form Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900">{% block form_title %}Form Title{% endblock %}</h1>
            <p class="text-lg text-gray-600 mt-2">{% block form_subtitle %}Form description goes here{% endblock %}</p>
        </div>
        
        <!-- Progress Bar (if multi-step form) -->
        {% block progress_bar %}{% endblock %}
        
        <!-- Main Form -->
        <form method="post" enctype="multipart/form-data" class="space-y-6" id="main-form">
            {% csrf_token %}
            
            <!-- Form Sections -->
            {% block form_sections %}
            <div class="form-section">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">{% block section_title %}Basic Information{% endblock %}</h2>
                
                <div class="form-grid">
                    <!-- First Name -->
                    <div class="form-group">
                        <label for="first_name" class="form-label required-field">First Name</label>
                        <input type="text" id="first_name" name="first_name" class="form-input" required 
                               value="{{ form.first_name.value|default:'' }}"
                               placeholder="Enter first name">
                        {% if form.first_name.errors %}
                        <div class="error-message">{{ form.first_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                    
                    <!-- Last Name -->
                    <div class="form-group">
                        <label for="last_name" class="form-label required-field">Last Name</label>
                        <input type="text" id="last_name" name="last_name" class="form-input" required
                               value="{{ form.last_name.value|default:'' }}"
                               placeholder="Enter last name">
                        {% if form.last_name.errors %}
                        <div class="error-message">{{ form.last_name.errors.0 }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Email -->
                <div class="form-group">
                    <label for="email" class="form-label required-field">Email Address</label>
                    <input type="email" id="email" name="email" class="form-input" required
                           value="{{ form.email.value|default:'' }}"
                           placeholder="Enter email address">
                    {% if form.email.errors %}
                    <div class="error-message">{{ form.email.errors.0 }}</div>
                    {% endif %}
                    <div class="help-text">We'll use this for important communications</div>
                </div>
                
                <!-- Phone -->
                <div class="form-group">
                    <label for="phone" class="form-label">Phone Number</label>
                    <input type="tel" id="phone" name="phone" class="form-input"
                           value="{{ form.phone.value|default:'' }}"
                           placeholder="Enter phone number">
                    {% if form.phone.errors %}
                    <div class="error-message">{{ form.phone.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            {% endblock %}
            
            <!-- Additional Form Sections -->
            {% block additional_sections %}{% endblock %}
            
            <!-- Terms and Conditions -->
            {% block terms_section %}
            <div class="form-section">
                <div class="form-group">
                    <div class="flex items-start space-x-3">
                        <input type="checkbox" id="terms" name="terms" class="form-checkbox mt-1" required>
                        <label for="terms" class="text-sm text-gray-700">
                            I agree to the 
                            <a href="#" class="text-primary-600 hover:text-primary-700 underline">Terms and Conditions</a>
                            and 
                            <a href="#" class="text-primary-600 hover:text-primary-700 underline">Privacy Policy</a>
                        </label>
                    </div>
                    {% if form.terms.errors %}
                    <div class="error-message">{{ form.terms.errors.0 }}</div>
                    {% endif %}
                </div>
            </div>
            {% endblock %}
            
            <!-- Form Actions -->
            <div class="form-actions">
                {% block form_actions %}
                <button type="button" class="btn-secondary" onclick="history.back()">
                    <i data-lucide="arrow-left" class="w-4 h-4 mr-2"></i>
                    Back
                </button>
                <button type="submit" class="btn-primary">
                    <i data-lucide="check" class="w-4 h-4 mr-2"></i>
                    {% block submit_text %}Submit{% endblock %}
                </button>
                {% endblock %}
            </div>
        </form>
    </div>
</div>

<!-- Form Validation Script -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('main-form');
    const inputs = form.querySelectorAll('input, select, textarea');
    
    // Real-time validation
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            validateField(this);
        });
        
        input.addEventListener('input', function() {
            if (this.classList.contains('error')) {
                clearFieldError(this);
            }
        });
    });
    
    // Form submission validation
    form.addEventListener('submit', function(e) {
        let isValid = true;
        
        inputs.forEach(input => {
            if (!validateField(input)) {
                isValid = false;
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            showToast('Please fix the errors before submitting', 'error');
        }
    });
    
    function validateField(field) {
        const value = field.value.trim();
        const isRequired = field.hasAttribute('required');
        
        // Clear previous errors
        clearFieldError(field);
        
        // Required field validation
        if (isRequired && !value) {
            showFieldError(field, 'This field is required');
            return false;
        }
        
        // Email validation
        if (field.type === 'email' && value) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(value)) {
                showFieldError(field, 'Please enter a valid email address');
                return false;
            }
        }
        
        // Phone validation
        if (field.type === 'tel' && value) {
            const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
            if (!phoneRegex.test(value.replace(/\s/g, ''))) {
                showFieldError(field, 'Please enter a valid phone number');
                return false;
            }
        }
        
        return true;
    }
    
    function showFieldError(field, message) {
        field.classList.add('error');
        
        // Remove existing error message
        const existingError = field.parentNode.querySelector('.error-message');
        if (existingError) {
            existingError.remove();
        }
        
        // Add new error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = message;
        field.parentNode.appendChild(errorDiv);
    }
    
    function clearFieldError(field) {
        field.classList.remove('error');
        
        const errorDiv = field.parentNode.querySelector('.error-message');
        if (errorDiv) {
            errorDiv.remove();
        }
    }
    
    // Auto-save form data
    let autoSaveTimer;
    inputs.forEach(input => {
        input.addEventListener('input', function() {
            clearTimeout(autoSaveTimer);
            autoSaveTimer = setTimeout(() => {
                saveFormData();
            }, 1000);
        });
    });
    
    function saveFormData() {
        const formData = new FormData(form);
        const data = {};
        
        for (let [key, value] of formData.entries()) {
            data[key] = value;
        }
        
        localStorage.setItem('form_autosave', JSON.stringify(data));
    }
    
    // Restore form data on page load
    function restoreFormData() {
        const savedData = localStorage.getItem('form_autosave');
        if (savedData) {
            const data = JSON.parse(savedData);
            
            inputs.forEach(input => {
                if (data[input.name] && !input.value) {
                    input.value = data[input.name];
                }
            });
        }
    }
    
    // Clear saved data on successful submission
    form.addEventListener('submit', function() {
        localStorage.removeItem('form_autosave');
    });
    
    // Restore data on page load
    restoreFormData();
});
</script>
{% endblock %}
