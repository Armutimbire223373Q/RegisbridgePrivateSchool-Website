{% extends "dashboard/base_dashboard.html" %}

{% block dashboard_title %}Student Dashboard{% endblock %}
{% block dashboard_heading %}Student Portal{% endblock %}
{% block page_title %}Student Dashboard{% endblock %}
{% block page_subtitle %}Your academics, attendance, and assignments{% endblock %}

{% block dashboard_main %}
<div class="flex items-center justify-between mb-6">
    <div></div>
    <form method="get" action="{% url 'grades:download_grade_pdf' student_profile.id %}" class="flex items-center space-x-2">
        <select name="term_id" class="border rounded px-2 py-1">
            <option value="">All Terms</option>
            {% for t in terms %}
            <option value="{{ t.id }}">{{ t.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-accent inline-flex items-center">
            <i data-lucide="download" class="w-4 h-4 mr-2"></i>
            Download Grade Report (PDF)
        </button>
    </form>
</div>

<!-- Student Stats Overview -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <!-- Current Grade -->
    <div class="stat-card primary">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-primary-100 text-sm font-medium">Current Grade</p>
                <p class="text-3xl font-bold">{{ current_grade|default:"N/A" }}</p>
                <p class="text-primary-100 text-sm">Academic level</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i data-lucide="graduation-cap" class="w-8 h-8 text-white"></i>
            </div>
        </div>
    </div>
    
    <!-- Attendance Rate -->
    <div class="stat-card secondary">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-blue-100 text-sm font-medium">Attendance</p>
                <p class="text-3xl font-bold">{{ attendance_rate|default:"0" }}%</p>
                <p class="text-blue-100 text-sm">This term</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i data-lucide="calendar-check" class="w-8 h-8 text-white"></i>
            </div>
        </div>
    </div>
    
    <!-- Pending Assignments -->
    <div class="stat-card accent">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-amber-100 text-sm font-medium">Due Soon</p>
                <p class="text-3xl font-bold">{{ pending_assignments|default:"0" }}</p>
                <p class="text-amber-100 text-sm">Assignments due</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i data-lucide="clock" class="w-8 h-8 text-white"></i>
            </div>
        </div>
    </div>
    
    <!-- Average Grade -->
    <div class="stat-card success">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-green-100 text-sm font-medium">Average Grade</p>
                <p class="text-3xl font-bold">{{ average_grade|default:"0" }}%</p>
                <p class="text-green-100 text-sm">This term</p>
            </div>
            <div class="bg-white bg-opacity-20 rounded-full p-3">
                <i data-lucide="award" class="w-8 h-8 text-white"></i>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
    <!-- View Timetable -->
    <div class="card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Today's Schedule</h3>
        <p class="text-gray-600 mb-4">Check your class schedule for today</p>
        <a href="{% url 'students:student_timetable' %}" class="btn-primary w-full">View Timetable</a>
    </div>
    
    <!-- Submit Assignment -->
    <div class="card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Submit Assignment</h3>
        <p class="text-gray-600 mb-4">Upload your completed assignments</p>
        <a href="{% url 'assignments:list' %}" class="btn-secondary w-full">Submit Work</a>
    </div>
    
    <!-- Check Grades -->
    <div class="card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">My Grades</h3>
        <p class="text-gray-600 mb-4">View your academic performance</p>
        <a href="{% url 'grades:student_grades' %}" class="btn-accent w-full">View Grades</a>
    </div>
</div>

<!-- Today's Schedule -->
<div class="card mb-8">
    <h3 class="text-xl font-semibold text-gray-900 mb-6">Today's Schedule</h3>
    <div class="space-y-3">
        {% for lesson in today_lessons %}
        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center">
                    <span class="text-primary-600 font-semibold">{{ lesson.start_time|time:"H:i" }}</span>
                </div>
                <div>
                    <h4 class="font-semibold text-gray-900">{{ lesson.subject.name }}</h4>
                    <p class="text-sm text-gray-500">{{ lesson.teacher.get_full_name }} • Room {{ lesson.classroom.name }}</p>
                </div>
            </div>
            <div class="text-right">
                <p class="text-sm text-gray-500">{{ lesson.start_time|time:"H:i" }} - {{ lesson.end_time|time:"H:i" }}</p>
                <span class="text-xs bg-primary-100 text-primary-800 px-2 py-1 rounded-full">{{ lesson.duration }} min</span>
            </div>
        </div>
        {% empty %}
        <div class="text-center py-8">
            <i data-lucide="calendar" class="w-16 h-16 text-gray-400 mx-auto mb-3"></i>
            <p class="text-gray-500">No classes scheduled for today</p>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Academic Overview -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
    <!-- Recent Assignments -->
    <div class="card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Assignments</h3>
        <div class="space-y-3">
            {% for assignment in recent_assignments|slice:":5" %}
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <p class="font-medium text-gray-900">{{ assignment.title }}</p>
                    <p class="text-sm text-gray-500">{{ assignment.subject.name }} • Due: {{ assignment.due_date|date:"M d" }}</p>
                </div>
                <div class="text-right">
                    {% if assignment.submission %}
                        <span class="text-xs bg-success-100 text-success-800 px-2 py-1 rounded-full">Submitted</span>
                    {% else %}
                        <span class="text-xs bg-amber-100 text-amber-800 px-2 py-1 rounded-full">Pending</span>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <p class="text-gray-500 text-center py-4">No recent assignments</p>
            {% endfor %}
        </div>
    </div>
    
    <!-- Recent Grades -->
    <div class="card">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Grades</h3>
        <div class="space-y-3">
            {% for grade in recent_grades|slice:":5" %}
            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                <div>
                    <p class="font-medium text-gray-900">{{ grade.assignment.title }}</p>
                    <p class="text-sm text-gray-500">{{ grade.assignment.subject.name }}</p>
                </div>
                <div class="text-right">
                    <p class="font-semibold text-gray-900">{{ grade.marks_obtained }}/{{ grade.assignment.max_marks }}</p>
                    <span class="text-xs bg-primary-100 text-primary-800 px-2 py-1 rounded-full">{{ grade.percentage|floatformat:1 }}%</span>
                </div>
            </div>
            {% empty %}
            <p class="text-gray-500 text-center py-4">No recent grades</p>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Performance Chart -->
<div class="card">
    <h3 class="text-xl font-semibold text-gray-900 mb-4">Academic Performance</h3>
    <div class="h-64 bg-gray-50 rounded-lg flex items-center justify-center">
        <div class="text-center">
            <i data-lucide="trending-up" class="w-16 h-16 text-gray-400 mx-auto mb-3"></i>
            <p class="text-gray-500">Performance chart will be displayed here</p>
            <p class="text-sm text-gray-400">Grade trends over time</p>
        </div>
    </div>
</div>
{% endblock %}
