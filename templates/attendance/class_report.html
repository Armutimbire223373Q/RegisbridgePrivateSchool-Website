{% extends 'public/base.html' %}
{% block content %}
<section class="py-5">
  <div class="container">
    <h1 class="fw-bold mb-3">Class Attendance Report</h1>
    <form class="row g-2 mb-4" method="get">
      <div class="col-md-4">
        <select class="form-select" name="classroom">
          <option value="">Select class</option>
          {% for c in classes %}
          <option value="{{ c.id }}" {% if selected_class and selected_class.id == c.id %}selected{% endif %}>{{ c.grade_level.name }} - {{ c.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3"><input class="form-control" type="date" name="start" value="{{ start|date:'Y-m-d' }}"></div>
      <div class="col-md-3"><input class="form-control" type="date" name="end" value="{{ end|date:'Y-m-d' }}"></div>
      <div class="col-md-2"><button class="btn btn-primary w-100" type="submit">Filter</button></div>
    </form>

    {% if records %}
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr><th>Date</th><th>Student</th><th>Status</th><th>Remarks</th></tr>
        </thead>
        <tbody>
          {% for r in records %}
          <tr>
            <td>{{ r.session.date }}</td>
            <td><a href="{% url 'attendance_student_report' r.student.id %}">{{ r.student.user.get_full_name|default:r.student.user.username }}</a></td>
            <td>{{ r.get_status_display }}</td>
            <td>{{ r.remarks }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% elif selected_class %}
      <div class="alert alert-info">No records for selected range.</div>
    {% endif %}
  </div>
</section>
{% endblock %}

